# 不動産営業支援システム - マッチング機能仕様書

## 1. 概要

### 1.1 目的
物件情報と顧客の購買条件を自動的に照合し、最適なマッチングを提案することで営業効率を向上させる。

### 1.2 対象ユーザー
- 営業担当者：自分の担当顧客とのマッチングを確認
- マネージャー：チーム全体のマッチング状況を管理
- 管理者：システム全体のマッチング状況を監視

## 2. マッチング計算ロジック

### 2.1 基本マッチングスコア計算式

```
総合マッチングスコア = Σ(項目スコア × 重み) × 100
最大スコア = 100点
```

### 2.2 評価項目と重み

| 項目 | 重み | 説明 |
|------|------|------|
| 予算適合度 | 30% | 顧客予算と物件価格の適合性 |
| エリア適合度 | 25% | 希望エリアと物件所在地の適合性 |
| 物件タイプ適合度 | 20% | 希望物件タイプとの適合性 |
| 面積適合度 | 15% | 希望面積との適合性 |
| 利回り適合度 | 10% | 期待利回りとの適合性 |

### 2.3 詳細計算ロジック

#### 2.3.1 予算適合度計算（重み：30%）
```
予算適合度スコア = 以下の条件に基づく

物件価格 <= 顧客予算下限 → 0.3
顧客予算下限 < 物件価格 <= 顧客予算上限 → 1.0
顧客予算上限 < 物件価格 <= 顧客予算上限×1.1 → 0.8
顧客予算上限×1.1 < 物件価格 <= 顧客予算上限×1.2 → 0.6
顧客予算上限×1.2 < 物件価格 <= 顧客予算上限×1.3 → 0.4
物件価格 > 顧客予算上限×1.3 → 0.0
```

#### 2.3.2 エリア適合度計算（重み：25%）
```
エリア適合度スコア = 以下の条件に基づく

物件の都道府県 = 顧客希望エリア → 1.0
物件の都道府県 ≠ 顧客希望エリア → 0.0

※将来拡張：市区町村レベル、駅距離での細分化
```

#### 2.3.3 物件タイプ適合度計算（重み：20%）
```
物件タイプ適合度スコア = 以下の条件に基づく

物件タイプ = 顧客希望タイプ → 1.0
物件タイプ ≠ 顧客希望タイプ → 0.0

※関連性マッピング（将来拡張）：
- 店舗 ⇔ 事務所 → 0.7
- 一棟ビル ⇔ 区分 → 0.6
```

#### 2.3.4 面積適合度計算（重み：15%）
```
面積適合度スコア = 以下の条件に基づく

希望面積の80%以上120%以下 → 1.0
希望面積の60%以上80%未満 または 120%以上140%以下 → 0.8
希望面積の40%以上60%未満 または 140%以上160%以下 → 0.6
希望面積の20%以上40%未満 または 160%以上180%以下 → 0.4
上記以外 → 0.0

※建物面積を基準とし、土地面積は参考値
```

#### 2.3.5 利回り適合度計算（重み：10%）
```
利回り適合度スコア = 以下の条件に基づく

物件利回り >= 顧客期待利回り → 1.0
物件利回り >= 顧客期待利回り×0.9 → 0.8
物件利回り >= 顧客期待利回り×0.8 → 0.6
物件利回り >= 顧客期待利回り×0.7 → 0.4
物件利回り < 顧客期待利回り×0.7 → 0.0

※利回りデータがない場合は0.5（中立値）
```

## 3. マッチングステータス管理

### 3.1 ステータス定義

| ステータス | 説明 | 次のアクション |
|------------|------|----------------|
| matched | 自動マッチング完了 | 営業担当者による確認 |
| reviewed | 営業担当者が確認済み | 顧客への提案準備 |
| presented | 顧客に提案済み | 顧客からの回答待ち |
| interested | 顧客が興味を示した | 詳細説明・内見調整 |
| not_interested | 顧客が興味なし | クローズ |
| contracted | 契約成立 | 取引完了処理 |
| expired | 有効期限切れ | 再検討または削除 |

### 3.2 ステータス遷移図
```
matched → reviewed → presented → interested → contracted
   ↓         ↓          ↓           ↓
expired   expired   not_interested  expired
```

## 4. 自動マッチング処理

### 4.1 実行タイミング
- 新規物件登録時：全アクティブ顧客との照合
- 新規顧客登録時：全利用可能物件との照合
- 顧客条件更新時：該当顧客の再マッチング
- 物件情報更新時：該当物件の再マッチング
- 定期バッチ処理：日次で全データの再計算

### 4.2 マッチング閾値
```
自動マッチング対象：スコア >= 60点
高優先度マッチング：スコア >= 80点
要注意マッチング：スコア >= 90点
```

### 4.3 除外条件
- 物件ステータスが「売却済み」「取り下げ」
- 顧客ステータスが「非アクティブ」「契約済み」
- 既に同じ組み合わせで「not_interested」または「contracted」

## 5. マッチング詳細機能

### 5.1 マッチング詳細ページ
#### 5.1.1 表示情報
- マッチングスコア（総合・項目別）
- 物件詳細情報
- 顧客詳細情報
- マッチング根拠の可視化
- ステータス履歴
- 営業メモ・コメント

#### 5.1.2 操作機能
- ステータス更新
- 営業メモ追加
- 提案資料作成
- 顧客への連絡履歴記録
- マッチング除外設定

### 5.2 提案管理機能
#### 5.2.1 提案作成
- 物件資料の自動生成
- 顧客向けカスタマイズ
- 提案日時の記録
- 提案方法の記録（メール・電話・面談）

#### 5.2.2 提案追跡
- 顧客反応の記録
- フォローアップ予定管理
- 競合他社情報
- 価格交渉履歴

## 6. 分析・レポート機能

### 6.1 マッチング分析
- スコア分布分析
- 成約率分析（スコア別）
- 項目別重要度分析
- 営業担当者別パフォーマンス

### 6.2 改善提案
- 低スコア要因分析
- 在庫回転率改善提案
- 顧客ニーズトレンド分析
- 価格設定最適化提案

## 7. 技術仕様

### 7.1 データベース設計
```sql
-- マッチングテーブル
property_matches (
    id: 主キー
    property_id: 物件ID（外部キー）
    customer_id: 顧客ID（外部キー）
    match_score: マッチングスコア（0-100）
    budget_score: 予算適合度スコア
    area_score: エリア適合度スコア
    type_score: タイプ適合度スコア
    size_score: 面積適合度スコア
    yield_score: 利回り適合度スコア
    status: ステータス
    created_by: 作成者ID
    reviewed_at: 確認日時
    presented_at: 提案日時
    response_at: 回答日時
    notes: 営業メモ
    created_at: 作成日時
    updated_at: 更新日時
)
```

### 7.2 API仕様
```
GET /api/matches - マッチング一覧取得
GET /api/matches/{id} - マッチング詳細取得
POST /api/matches - 手動マッチング作成
PUT /api/matches/{id} - マッチング更新
DELETE /api/matches/{id} - マッチング削除
POST /api/matches/bulk-generate - 一括マッチング生成
PUT /api/matches/{id}/status - ステータス更新
POST /api/matches/{id}/notes - メモ追加
```

### 7.3 パフォーマンス要件
- マッチング計算：1件あたり10ms以内
- 一覧表示：100件を1秒以内
- 詳細表示：500ms以内
- バッチ処理：10,000件を10分以内

## 8. セキュリティ・権限管理

### 8.1 アクセス制御
- 営業担当者：自分の担当顧客のマッチングのみ
- マネージャー：部門内のマッチング全て
- 管理者：全てのマッチング

### 8.2 データ保護
- 顧客情報の暗号化
- アクセスログの記録
- データ変更履歴の保持
- 定期的なバックアップ

## 9. 運用・メンテナンス

### 9.1 モニタリング
- マッチング精度の定期的な検証
- システムパフォーマンスの監視
- エラー発生状況の追跡
- ユーザー利用状況の分析

### 9.2 改善サイクル
- 月次：マッチング精度レビュー
- 四半期：重み係数の調整
- 半年：新機能の追加検討
- 年次：システム全体の見直し

## 10. 今後の拡張計画

### 10.1 機械学習の導入
- 成約データを活用した学習モデル
- 個人の嗜好を考慮したパーソナライゼーション
- 市場動向を反映した動的スコア調整

### 10.2 外部データ連携
- 不動産市場データの取り込み
- 地価情報・交通情報の活用
- 競合他社情報の収集・分析

### 10.3 UI/UX改善
- モバイルアプリの開発
- 音声入力・検索機能
- AR/VRを活用した物件案内

---

**作成日：2024年12月26日**  
**バージョン：1.0**  
**作成者：システム開発チーム** 